# 📋 クリップボードマネージャー

macOS用のモダンな常駐クリップボード管理アプリです。コピーしたテキストの履歴を自動的に保存し、スニペットフォルダで整理できます。

## 🖥️ 対応プラットフォーム
- 対応OS: macOS 13 Ventura 以降
- CPU: Apple Silicon / Intel（いずれも対応）

## ✨ 主要機能

### 🎯 コア機能
- **自動履歴保存**: コピーしたテキストを自動的に履歴に保存
- **メニューバーアクセス**: モダンなアイコンでメニューバーから簡単アクセス
- **スニペット管理**: よく使うテキストをスニペットとして保存・管理
- **フォルダ整理**: カスタムフォルダでスニペットを分類・整理
- **履歴管理画面**: モダンなUIで詳細な履歴管理と検索機能

### 🔧 詳細機能
- **履歴制限**: 直近50件の履歴を自動保存
- **重複除外**: 重複するテキストの自動除外
- **リアルタイム検索**: 検索機能による履歴の絞り込み
- **スニペット登録**: 直接スニペットを登録・編集可能
- **フォルダ別表示**: スニペットフォルダごとの表示
- **フォルダ編集**: フォルダ名・色の変更とスニペット移動
- **データ永続化**: UserDefaultsによる安全なデータ保存
- **モダンUI**: カードベースの美しいインターフェース
 - **メニューバースクロール**: フォルダ配下のスニペットが8件を超える場合、サブメニューがスクロール表示になり全件にアクセス可能
 - **検索時自動展開**: スニペット検索時は該当スニペットを含むフォルダが自動的に展開され、結果を即座に確認可能

## 🚀 使用方法

### 📱 基本的な使い方
1. **アプリ起動**: アプリを起動すると、メニューバーにモダンなクリップボードアイコンが表示されます
2. **自動保存**: テキストをコピーすると、自動的に履歴に保存されます
3. **メニューアクセス**: メニューバーのアイコンをクリックすると、以下のメニューが表示されます：
   - **📋 履歴**: 最近のコピー履歴（サブメニュー）
   - **スニペット**: フォルダ別のスニペット（サブメニュー）
   - **⚙️ 履歴を管理...**: 詳細管理画面を開く
   - **🚪 終了**: アプリを終了
4. **再コピー**: メニューからテキストを選択すると、クリップボードに再コピーされます

### 🎛️ 履歴管理画面
1. **管理画面を開く**: メニューバーから「⚙️ 履歴を管理...」を選択
2. **履歴タブ**: コピー履歴を確認・管理
3. **スニペットタブ**: フォルダ別にスニペットを管理
4. **検索機能**: リアルタイム検索で履歴を絞り込み
5. **アイテム操作**: 各アイテムからコピー、スニペット追加、フォルダ変更、削除が可能

### 📝 スニペット管理
- **スニペット登録**: 直接スニペットを登録・編集可能
- **説明追加**: スニペットに説明を追加して管理
- **フォルダ分類**: スニペットをフォルダごとに分類
- **編集機能**: スニペットの内容・説明・フォルダを編集可能

### 📁 スニペットフォルダ管理
- **フォルダ作成**: カスタムフォルダを作成してスニペットを整理
- **色分け**: フォルダごとに色を設定して視覚的に区別
- **フォルダ編集**: フォルダ名・色の変更が可能
- **スニペット移動**: フォルダ編集画面でスニペットを移動可能

#### フォルダ編集画面でのスニペット移動
1. **フォルダ編集を開く**: スニペットタブでフォルダの「編集」ボタンをクリック
2. **フォルダなしのスニペット確認**: 編集画面下部に「フォルダなしのスニペット」セクションが表示
3. **スニペット選択**: 移動したいスニペットのチェックボックスを選択
4. **移動実行**: 「このフォルダに移動」ボタンをクリック
5. **確認**: 確認ダイアログで「このフォルダに移動」を選択

## 🛠️ 技術仕様

### 🏗️ アーキテクチャ
- **Swift Package Manager**: モダンなパッケージ管理
- **AppKit + SwiftUI**: メニューバーはAppKit、管理画面はSwiftUI
- **MVVM パターン**: データ管理とUIの分離
- **ObservableObject**: リアクティブなデータバインディング
- **MainActor**: 安全なUI更新とスレッド管理

### 📁 主要クラス
- `AppDelegate`: アプリケーションのエントリーポイント
- `ClipboardManager`: クリップボード監視とメニューバー管理
- `ClipboardDataManager`: データの管理と永続化
- `ClipboardItem`: クリップボードアイテムのデータモデル
- `FavoriteFolder`: スニペットフォルダのデータモデル
- `HistoryWindowController`: 履歴管理ウィンドウの制御
- `HistoryView`: 履歴管理画面のSwiftUIビュー
- `FolderEditView`: フォルダ編集画面のSwiftUIビュー

### 💾 データ永続化
- **UserDefaults**: 安全なデータ保存
- **Codable**: JSON形式でのエンコード・デコード
- **後方互換性**: カスタムデコーダーによる既存データとの互換性
- **エラーハンドリング**: 堅牢なデータ読み込み処理

## 🔨 環境構築とビルド

### 📋 要件
- **macOS**: 13.0以上
- **Swift**: 6.1以上
- **Swift Package Manager**: 6.1以上
- **Xcode**: 15.0以上（推奨）

### 🛠️ 環境構築手順

#### 1. Xcodeのインストール
```bash
# App StoreからXcodeをインストール
# または、Apple Developerサイトからダウンロード
```

#### 2. コマンドラインツールの設定
```bash
# Xcodeのコマンドラインツールを設定
sudo xcode-select --install

# ライセンスに同意
sudo xcodebuild -license accept

# アクティブなディレクトリを設定
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
```

#### 3. Swiftの確認
```bash
# Swiftのバージョンを確認
swift --version

# 期待される出力例:
# Swift version 6.1 (swift-6.1-RELEASE)
```

#### 4. Gitの設定（初回のみ）
```bash
# Gitの設定
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# SSH鍵の設定（GitHub使用時）
ssh-keygen -t ed25519 -C "your.email@example.com"
# 生成された公開鍵をGitHubに追加
```

#### 5. 権限設定
初回起動時に以下の権限が必要です：

**クリップボードアクセス権限**
1. アプリを起動すると権限許可ダイアログが表示されます
2. 「許可」をクリック
3. システム環境設定が開くので、「許可」をクリック
4. メニューバーにクリップボードアイコンが表示されれば成功

**アクセシビリティ権限（グローバルホットキー使用時）**
1. システム環境設定 > セキュリティとプライバシー > プライバシー > アクセシビリティ
2. アプリケーションを追加してチェックを入れる

### 🚀 ビルド手順

#### 1. リポジトリのクローン
```bash
# HTTPS経由でクローン
git clone https://github.com/komody/ClipboardManager.git
cd ClipboardManager

# またはSSH経由でクローン
git clone git@github.com:komody/ClipboardManager.git
cd ClipboardManager
```

#### 2. 依存関係の解決
```bash
# 依存関係を解決（このプロジェクトは外部依存なし）
swift package resolve
```

#### 3. ビルド
```bash
# デバッグビルド
swift build

# リリースビルド
swift build -c release
```

#### 4. 実行
```bash
# デバッグモードで実行
swift run

# リリースモードで実行
swift run -c release
```

#### 5. 初回起動
1. `swift run`でアプリを起動
2. 権限許可ダイアログで「許可」をクリック
3. メニューバーにクリップボードアイコンを確認
4. アイコンをクリックしてメニューが表示されることを確認
5. テキストをコピーして履歴に保存されることを確認

### 🔧 トラブルシューティング

#### よくある問題と解決方法

**1. `xcode-select: error: tool 'xcodebuild' requires Xcode`**
```bash
# Xcodeがインストールされていない場合
# App StoreからXcodeをインストール

# または、コマンドラインツールのみの場合
sudo xcode-select --install
```

**2. `swift: command not found`**
```bash
# Swiftがインストールされていない場合
# Xcodeをインストールすると自動的にインストールされます
```

**3. ビルドエラーが発生する場合**
```bash
# キャッシュをクリア
swift package clean
swift package reset

# 再ビルド
swift build
```

**4. 権限エラーが発生する場合**
```bash
# クリップボードアクセス権限を確認
# システム環境設定 > セキュリティとプライバシー > プライバシー > アクセシビリティ
```

### 📦 配布

#### 1. リリースビルド
```bash
# リリースビルドを実行
swift build -c release

# 実行ファイルの場所
.build/release/ClipboardManager
```

#### 2. アプリケーション化
```bash
# アプリケーションフォルダにコピー
cp .build/release/ClipboardManager /Applications/

# または、アプリケーションバンドルを作成
# （Xcodeプロジェクトとして配布する場合）
```

#### 3. 初回起動時の注意事項
- クリップボードアクセス権限の許可が必要
- グローバルホットキー使用時はアクセシビリティ権限が必要
- メニューバーにクリップボードアイコンが表示されることを確認

## ⚙️ カスタマイズ

### 🔧 設定可能な項目
- `maxHistoryCount`: 保存する履歴の最大件数（デフォルト: 50）
- `clipboardTimer`: クリップボード監視の間隔（デフォルト: 1.0秒）
- `folderColors`: スニペットフォルダの色設定（12色のパレット）
- `snippetDescription`: スニペットの説明フィールド

### 🚀 拡張のアイデア
- **ドラッグ&ドロップ**: ファイルや画像の履歴管理
- **キーボードショートカット**: グローバルホットキー対応
- **クラウド同期**: iCloud連携による複数デバイス同期
- **テーマカスタマイズ**: ダークモード対応
- **スニペット検索**: スニペット内容での検索機能
- **スニペットタグ**: タグによるスニペット分類
- **プラグインシステム**: 拡張機能の追加

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## ⚠️ 注意事項

- **プライバシー**: このアプリはクリップボードの内容を監視します
- **機密情報**: 機密情報を含むテキストをコピーする際は注意してください
- **データ保存**: すべてのデータはローカルに保存され、外部に送信されません
- **終了方法**: アプリを終了するには、メニューバーから「🚪 終了」を選択してください

## 📊 プロジェクト情報

- **開発言語**: Swift 6.1
- **UI フレームワーク**: SwiftUI + AppKit
- **パッケージ管理**: Swift Package Manager
- **データ永続化**: UserDefaults
- **アーキテクチャ**: MVVM + ObservableObject

## 🤝 貢献

プルリクエストやイシューの報告を歓迎します。詳細は[調査レポート.md](./調査レポート.md)をご覧ください。

